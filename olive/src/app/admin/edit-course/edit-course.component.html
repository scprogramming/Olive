<app-sidebar></app-sidebar>

<div class="dashboardBody">
  <div class="tab">
    <div id="curriculum">
      <button
        class="tabButton"
        #CurriculumButton
        (click)="toggle(CurriculumElement, CurriculumButton)"
      >
        Curriculum
      </button>
    </div>

    <div id="pricing">
      <button
        class="tabButton"
        #PricingButton
        (click)="toggle(PricingElement, PricingButton)"
      >
        Pricing
      </button>
    </div>

    <div id="courseDetails">
      <button
        class="tabButton"
        #CourseDetailButton
        (click)="toggle(CourseDetailElement, CourseDetailButton)"
      >
        Course Details
      </button>
    </div>
  </div>

  <div #CurriculumElement class="content hidden">
    <div id="curriculumContainer" *ngIf="courses">
      <div id="curriculumModuleBar">
        <div *ngFor="let module of courses.content; let indexOfelement = index">
          <div #ModuleTitle  class="collapsible">
            <span (click)="basicToggle(moduleTop)">{{ module.module_title }}</span>
            <span (click)="promptDetailEdit(EditModulePrompt, ModuleTitle, 'editModulePrompt','collapsible')">
              <fa-icon  [icon]="faEdit"></fa-icon>
            </span>
            <span #DeleteModule id="module-{{indexOfelement}}-delete" (click)="deleteModule(DeleteModule)">
              <fa-icon [icon]="faTrash"></fa-icon>
            </span>
          </div>
          <div #EditModulePrompt class="editModulePrompt hidden">
            <input
              id="input-m-{{ indexOfelement }}"
              #ModuleTitleInput
              type="text"
              value="{{module.module_title}}"
            />
            <button (click)="editModuleTitle(EditModulePrompt, ModuleTitle, ModuleTitleInput)">Save</button>

          </div>
          
          


          <div #moduleTop class="hidden">
            <div
              id="content-module{{ indexOfelement }}"
              class="lessonSmall"
              *ngFor="let lesson of module.lessons; let indexOfLesson = index"
            >
              <p
                #CurrentLesson
                id="module-{{ indexOfelement }}-lesson-{{ indexOfLesson }}"
                (click)="
                  showContent(CurrentLesson, 'lessonContent', '-content')
                "
                class="lessonSmall"
              >
                {{ lesson.lesson_title }}
              </p>
            </div>
            <div #LessonPrompt class="lessonPrompt hidden">
              <input
                id="input-m-{{ indexOfelement }}"
                #LessonTitleInput
                type="text"
                placeholder="Enter a lesson title"
              />
              <button (click)="addLesson(LessonTitleInput)">Save</button>
            </div>

            <button (click)="promptLesson(LessonPrompt)">Add lesson</button>
          </div>
        </div>

        <div *ngIf="addingModule">
          <input
            #ModuleTitleInput
            type="text"
            placeholder="Enter a module title"
          />
          <button (click)="addModule(ModuleTitleInput)">Save</button>
        </div>

        <button (click)="promptModule()">Add module</button>
      </div>
      <div *ngFor="let module of courses.content; let indexOfelement = index">
        <div
          *ngFor="let lesson of module.lessons; let indexOfLesson = index"
          id="curriculumContent"
        >
          <div
            class="lessonContent hidden"
            id="module-{{ indexOfelement }}-lesson-{{ indexOfLesson }}-content"
          >
            <input #TitleInput id="module-{{indexOfelement}}-lesson-{{indexOfLesson}}-Title" type="text" value="{{lesson.lesson_title}}"/>
            <button  (click)="updateLessonTitle(TitleInput)">Save Title</button>
            <div *ngIf="lesson.content.type === ''">
              <p>Add a new block of content</p>
              <button
                #VideoElement
                (click)="showContent(VideoElement, 'lessonBlock', '-video')"
                id="Module{{ indexOfelement }}Lesson{{ indexOfLesson }}-v"
              >
                Video
              </button>
              <button>Rich text</button>

              <div
                class="lessonBlock hidden"
                id="Module{{ indexOfelement }}Lesson{{ indexOfLesson }}-v-video"
              >
                <h2>Upload a video</h2>
                <input
                  #VideoInput
                  id="m-{{ indexOfelement }}-l-{{ indexOfLesson }}-vu"
                  type="file"
                  accept="video/*"
                  (change)="readVideo(VideoInput, UploadPreview)"
                />
                <video #UploadPreview class="previewVideo" controls></video>
              </div>
            </div>



            <div *ngIf="lesson.content.type === 'serverVideo'">
              <p>{{ lesson.lesson_title }}</p>
              <div class="videoContainer">
                <video
                  class="previewVideo"
                  controls
                  src="{{ lesson.content.data }}"
                ></video>
              </div>
            </div>

            <button #DeleteButton id="module-{{indexOfelement}}-lesson-{{indexOfLesson}}-Delete" (click)="deleteLesson(DeleteButton)">Delete Lesson</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="courseContainer" #CourseDetailElement class="content hidden">
    <div *ngIf="courses">
      <h3>What you'll learn</h3>
      <div *ngFor="let learn of courses.learning_objective; let indexOfelement = index">
        <span class="learningObj" #LearningObjective>{{learn}}
          <span (click)="promptDetailEdit(EditLearnObjPrompt, LearningObjective, 'editLearnObjPrompt','learningObj')">
            <fa-icon  [icon]="faEdit"></fa-icon>
          </span>
          <span #LearnDelete id = 'lo-{{indexOfelement}}-delete' (click)="deleteLearningObj(LearnDelete)">
            <fa-icon [icon]="faTrash"></fa-icon>
          </span>
        </span>
        <div #EditLearnObjPrompt class="editLearnObjPrompt hidden">
          <input
            id="input-m-{{ indexOfelement }}"
            #LearnObjInput
            type="text"
            value="{{learn}}"
          />
          <button (click)="editDetail(EditLearnObjPrompt, LearningObjective, LearnObjInput,'learningObj')">Save</button>
        </div>
        
  
      </div>
      
      <div *ngIf="addingLearnObj">
        <input
          #LearningObjectiveInput
          type="text"
          placeholder="Enter a learning objective"
        />
        <button (click)="addObjective(LearningObjectiveInput)">Save</button>
      </div>

      <button (click)="promptLearningObjective()">Add learning objective</button>

      <h3>Audience</h3>
      <div *ngFor="let audience of courses.audience; let indexOfelement = index">
        <span class="audienceTitle" #Audience>{{audience}}
          <span (click)="promptDetailEdit(EditAudiencePrompt, Audience, 'editAudiencePrompt','audienceTitle')" id = 'audience-{{indexOfelement}}-edit'>
            <fa-icon  [icon]="faEdit"></fa-icon>
          </span>
          <span id = 'audience-{{indexOfelement}}-delete' #AudienceDelete (click)="deleteAudience(AudienceDelete)">
            <fa-icon [icon]="faTrash"></fa-icon>
          </span>
        </span>

        <div #EditAudiencePrompt class="editAudiencePrompt hidden">
          <input
          id="input-m-{{ indexOfelement }}"
          #EditAudienceInput
          type="text"
          value="{{audience}}"
          />
          <button (click)="editDetail(EditAudiencePrompt, Audience, EditAudienceInput,'audienceTitle')">Save</button>
        </div>
      </div>

      <div *ngIf="addingAudience">
        <input
          #AudienceInput
          type="text"
          placeholder="Enter an audience"
        />
        <button (click)="addAudience(AudienceInput)">Save</button>
      </div>

      <button (click)="promptAudience()">Add learning objective</button>

      <h3>Requirements</h3>
      <div *ngFor="let requirement of courses.requirements; let indexOfelement = index">
        <span class="requirementTitle" #RequirementTitle>{{requirement}}
        <span (click)="promptDetailEdit(EditRequirementPrompt, RequirementTitle, 'editRequirementPrompt','requirementTitle')" id = 'audience-{{indexOfelement}}-edit'>
          <fa-icon  [icon]="faEdit"></fa-icon>
        </span>
        <span id = 'req-{{indexOfelement}}-delete' #RequirementDelete (click)="deleteRequirement(RequirementDelete)">
          <fa-icon [icon]="faTrash"></fa-icon>
        </span>
      </span>

        <div #EditRequirementPrompt class="editRequirementPrompt hidden">
          <input
          id="input-m-{{ indexOfelement }}"
          #EditRequirementInput
          type="text"
          value="{{requirement}}"
          />
          <button (click)="editDetail(EditRequirementPrompt, RequirementTitle, EditRequirementInput,'requirementTitle')">Save</button>
        </div>
  
      </div>
    
      <div *ngIf="addingRequirement">
        <input
          #ReqInput
          type="text"
          placeholder="Enter an audience"
        />
        <button (click)="addRequirement(ReqInput)">Save</button>
      </div>

      <button (click)="promptRequirement()">Add learning objective</button>

    </div>
  </div>

  <div #PricingElement id="pricingContainer" class="content hidden">
    <div *ngIf="showPriceTable">
      <button class="mainButton" (click)="planPrompt()">Add Plan</button>
      <div *ngIf="courses">
        <table class="styled-table">
          <thead>
            <tr>
              <th>Plan Name</th>
              <th>Plan Type</th>
              <th>Currency</th>
              <th>Pay Amount</th>
              <th>Frequency</th>
              <th>Status</th>
              <th>Edit</th>
              <th>Delete</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let pay of courses.payment_options; let indexOfelement = index">
              <th>{{ pay.plan_name }}</th>
              <td>{{ pay.plan_type }}</td>
              <td>{{ pay.currency }}</td>
              <td>{{ pay.pay_amount }}</td>
              <td>{{ pay.frequency }}</td>
              <td>{{ pay.status }}</td>
              <td #PayEditItem id="PayItem-{{indexOfelement}}-edit" (click)="editPayOption(PayEditItem)"><fa-icon [icon]="faEdit"></fa-icon></td>
              <td #PayDeleteItem id="PayItem-{{indexOfelement}}-delete" (click)="deletePayOption(PayDeleteItem)"><fa-icon [icon]="faTrash"></fa-icon></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div *ngIf="addPayPlan">
      <label for="planTypes">Choose a payment plan type</label>
      <select [(ngModel)] = "planTypeSelect" #PlanSelect (change)="changePlanType(PlanSelect)" name="planTypes" id="planTypes">
      <option value="Free">Free</option>
      <option value="One-time">One time payment</option>
      <option value="Subscription">Subscription</option>
    </select>

    <label for="planNameInput">Enter a plan name</label>
    <input #PlanName id="planNameInput" [(ngModel)]="planAddName" type="text" required placeholder="plan name">

    <div *ngIf="showPaidFields">
      <label for="currencySelect" class="paidOption subscriptionOption">Select a currency</label>
      <select [(ngModel)]="currencySelectValue" name="currencySelect" id="currencySelect" class="paidOption subscriptionOption">
        <option value="USD">USD</option>
        <option value="CAD">CAD</option>
      </select>

      <label for="payAmount" class="paidOption subscriptionOption">Enter the amount to pay</label>
      <input type="text" [(ngModel)]="planAmountValue" id="payAmount" class="paidOption subscriptionOption" placeholder="Payment amount">
    </div>

    <div *ngIf="showSubFields">
      <label for="frequencyPay" class="subscriptionOption">Enter the payment frequency</label>
      <select [(ngModel)]="payFrequencyValue" name="frequencyPay" id="frequencyPay" class="subscriptionOption">
        <option value="Monthly">Monthly</option>
        <option value="Yearly">Yearly</option>
      </select>
    </div>

    <div *ngIf="updatePaymentPlan">
      <button class="mainButton" (click)="savePaymentPlan(PlanSelect, PlanName)">Edit Plan</button>
    <button class="mainButton" (click)="cancelAddPayment()">Cancel</button>
    </div>

    <div *ngIf="!updatePaymentPlan">
      <button class="mainButton" (click)="savePaymentPlan(PlanSelect, PlanName)">Save</button>
      <button class="mainButton" (click)="cancelAddPayment()">Cancel</button>
    </div>

  </div>
  </div>
</div>
