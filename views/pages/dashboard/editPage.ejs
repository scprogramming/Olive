<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css" integrity="sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC" crossorigin="anonymous">
    <link rel="stylesheet" href="/public/sidebar.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/public/addPage.css">
    
  </head>

  <body>

    <div class="page-container">
      <div class="content-wrap">
          <div class="row">
              <%- include('navbar.ejs'); %>
          </div>
          <div class="row">
              <div class="col-2">
                  <%- include('sidebar.ejs'); %>
              </div>
              <div class="col-8">
                <input type="text" class="form-control" id="pageTitle" value=<%= title[0].page_title %>>     
                <button class="btn btn-primary" onclick="saveTitle()">Save Title</button>
                <p id="status"></p>
                <div id="pageContent">
                  
                  <% for (var i = 0; i < content.length; i++){ %>

                    <div class="buttonOverlay" id = 'block<%- content[i].block_id %>buttons'>
                      <a onclick="editBlock(<%=pageId%>,'hero','<%- content[i].block_id%>');"><i class="fa fa-edit"></i></button></a>  
                      <a onclick="deleteBlock('block<%- content[i].block_id %>');"><i class="fa fa-trash"></i></button></a>  
                    </div>
                    <div id=block<%- content[i].block_id %>> <%- content[i].content %> </div>

                    
                  <%}%>
                </div>
                <a href="/dashboard/addBlock/<%=pageId %>/hero">Primary Button</button>
              </div>
            </div>
      </div>
  </div>

  
</body>
 
<script>


    function deleteBlock(blockId){
      const deleteId = blockId.substring(5);
      fetch('<%- url %>:<%- port %>/api/deleteBlock/', {
        method:'POST',
        headers: {
                    "Content-Type": "application/json"
                },
        credentials:'include',
        body:JSON.stringify({block_id:deleteId, page_id: <%= pageId %>})
      })
      .then(res => res.json());

      document.getElementById(blockId).remove();
      document.getElementById(blockId + 'buttons').remove();
    }

    function editBlock(pageId,editType,block){
      location.href = `/dashboard/editBlock/${pageId}/${editType}/${block}`
    }

    function saveTitle(){

        let title = document.getElementById("pageTitle").value;

        fetch('<%= url %>:<%= port %>/api/editPageTitle', {
                method:'POST',
                headers: {
                    "Content-Type": "application/json"
                },
                credentials: 'include',
                body:JSON.stringify({page_id:<%= pageId %>, title:title})
                
            }).then(res => setResult(res));
    }

    async function setResult(res){
      let result = await res.json();
      document.getElementById("status").innerHTML = result.status;
    }

  
</script>


</html>